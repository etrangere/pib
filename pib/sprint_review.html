<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="script.js"></script>
    <script>
        // --- We'll set these globally ---
        window.prefix = null;
        window.baseUrl = null;

        // --- Step 1: Normalize path and compute prefix (same as before) ---
        const pathname = window.location.pathname.replace(/\/{2,}/g, '/');
        window.prefix = pathname.replace('.html', '');

        // --- Step 2: Fetch real server port ---
        fetch('./server-control.php?cmd=status')
            .then(response => {
                if (!response.ok) throw new Error('Network error: ' + response.status);
                return response.json();
            })
            .then(data => {
                // Use real port from PHP
                const port = data.port || 8088;

                // Build baseUrl with real port + original prefix logic
                window.baseUrl = `http://localhost:${port}${window.prefix}`;

                // Debug
                console.log('prefix:', window.prefix);
                console.log('Port:', port);
                console.log('Base URL:', window.baseUrl);
            })
            .catch(err => {
            });
    </script>
    <title>Sprint review</title>
</head>

<body>
<div><label for="step7">Step 7 -> select the checkbox to trigger progress bar increment:</label>
    <input type="checkbox" id="step7" name="step7" onchange="updateProgressBar('step7')">
</div>

<h1>Sprint review</h1>
<p>The sprint review is one of the Scrum ceremonies that take place within the Scrum agile framework. This meeting takes place at the end of each sprint, in order to review the work accomplished during the past sprint. This is the time to present the software developments made to the product, which are tested and functional. But more than just demonstrating the product, its corrections or its new features, the purpose of this meeting is also to discuss and identify possible improvements. Discover all the characteristics of the sprint review, who participates in it, its progress in stages and how to ensure an efficient organization!
</p>

</body>
</html>
<script>

    // Define the increment value
    let incrementValue = 12; // Set the initial value
    //Change value with method selection
    (async function initializeMethod() {
        const methoddev = await jsonStorage.getItem("val");
        if (methoddev === "Kanban") {
            incrementValue = 33;
        }
    })();


    // Function to update the progress bar and save the value
    async function updateProgressBar(stepId) {
        // Get the step checkbox by its ID
        const stepCheckbox = document.getElementById(stepId);

        // Check if the step checkbox element exists
        if (!stepCheckbox) {
            console.error("Step checkbox not found!");
            return;
        }

        // Calculate the progress increment
        const progressIncrement = stepCheckbox.checked ? incrementValue : -incrementValue;

        // Retrieve the overall progress value from jsonStorage
        const savedProgress = await jsonStorage.getItem("progress");
        let overallProgress = 0;

        if (savedProgress && !isNaN(savedProgress)) {
            overallProgress = parseInt(savedProgress, 10);
        }

        // Update the overall progress by adding the current progress increment
        overallProgress += progressIncrement;

        // Save the overall progress value to jsonStorage
        await jsonStorage.setItem("progress", overallProgress.toString());

        // Save the checked state of the step checkbox to jsonStorage
        await jsonStorage.setItem(stepId, stepCheckbox.checked ? "checked" : "unchecked");

        // Update the width of the progress bar
        document.getElementById("myBar").style.width = overallProgress + "%";
    }

    // Check if progress value exists in jsonStorage on page load
    document.addEventListener("DOMContentLoaded", async function() {
        // Retrieve the overall progress value from jsonStorage
        const savedProgress = await jsonStorage.getItem("progress");
        let overallProgress = 0;

        if (savedProgress && !isNaN(savedProgress)) {
            overallProgress = parseInt(savedProgress, 10);
        }

        // Get the step checkbox by its ID
        const stepCheckbox = document.getElementById("step7");

        // Check if the step checkbox element exists
        if (!stepCheckbox) {
            console.error("Step checkbox not found!");
            return;
        }

        // Retrieve the checked state of the step checkbox from jsonStorage
        const savedCheckboxValue = await jsonStorage.getItem("step7");
        if (savedCheckboxValue === "checked") {
            stepCheckbox.checked = true;
            overallProgress += incrementValue;
        } else {
            stepCheckbox.checked = false;
        }

        // Update the width of the progress bar with the overall progress value
        document.getElementById("myBar").style.width = overallProgress + "%";
    });
</script>
<script>
    const textareaContainer = document.getElementById("textarea-container");
    const textareas = textareaContainer.getElementsByTagName("textarea");
    const checkboxes = textareaContainer.querySelectorAll("input[type='checkbox']");

    let formValues = {};

    let counter = 0; // initialize counter variable

    for (let i = 0; i < textareas.length + checkboxes.length; i++) {
        if (i < textareas.length) {
            const textarea = textareas[i];
            const id = prefix + (counter + 1);
            textarea.id = id;
            formValues[id] = textarea.value;
            textarea.addEventListener("input", (event) => {
                formValues[id] = event.target.value;
                jsonStorage.setItem("formValues", JSON.stringify(formValues));
            });
            counter++; // increment counter variable
        } else {
            const checkbox = checkboxes[i - textareas.length];
            const id = prefix + (counter + 1);
            checkbox.id = id;
            formValues[id] = checkbox.checked;
            checkbox.addEventListener("change", (event) => {
                formValues[id] = event.target.checked;
                jsonStorage.setItem("formValues", JSON.stringify(formValues));
            });
            counter++; // increment counter variable
        }
    }

    // Wrap in async IIFE to use await
    (async () => {
        const savedFormValues = await jsonStorage.getItem("formValues");

        if (savedFormValues) {
            formValues = JSON.parse(savedFormValues);
            for (const id in formValues) {
                if (formValues.hasOwnProperty(id)) {
                    const element = document.getElementById(id);
                    if (element) {
                        if (element.tagName === "TEXTAREA") {
                            element.value = formValues[id];
                        } else if (element.tagName === "INPUT" && element.type === "checkbox") {
                            element.checked = formValues[id];
                        }
                    } else {
                        console.warn(`Element with id "${id}" not found on page`);
                    }
                }
            }
        }
    })();

    const updateButton = document.getElementById("update-button-all");
    if (updateButton) {
        updateButton.addEventListener("click", async () => {
            for (let i = 0; i < textareas.length + checkboxes.length; i++) {
                const id = prefix + (i + 1);
                const element = document.getElementById(id);
                if (element) {
                    if (element.tagName === "TEXTAREA") {
                        formValues[id] = element.value;
                    } else if (element.tagName === "INPUT" && element.type === "checkbox") {
                        formValues[id] = element.checked;
                    }
                } else {
                    console.warn(`Element with id "${id}" not found on page`);
                }
            }
            await jsonStorage.setItem("formValues", JSON.stringify(formValues));
            alert("Values updated!");
        });
    }

</script>